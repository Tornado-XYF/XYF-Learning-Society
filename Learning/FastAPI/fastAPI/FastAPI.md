# FASTAPI

## I/O密集型和CPU密集型

I/O密集型操作(适合并发)：

通过网络发送来自客户端的数据
客户端接收来自网络中的数据
磁盘中要由系统读取并提供给程序的文件的内容
程序提供给系统的要写入磁盘的内容
一个 API 的远程调用
一个数据库操作，直到完成
一个数据库查询，直到返回结果
等等.

CPU密集型操作(适合并行)：
音频或图像处理；
计算机视觉: 一幅图像由数百万像素组成，每个像素有3种颜色值，处理通常需要同时对这些像素进行计算；
机器学习: 它通常需要大量的"矩阵"和"向量"乘法。想象一个包含数字的巨大电子表格，并同时将所有数字相乘；
深度学习: 这是机器学习的一个子领域，同样适用。只是没有一个数字的电子表格可以相乘，而是一个庞大的数字集合，在很多情况下，你需要使用一个特殊的处理器来构建和使用这些模型。

## 异步

### 并发汉堡和并行汉堡

并发汉堡:与恋人点完汉堡后，拿到号码牌，在等待的时间可以和恋人聊天，玩游戏

并行汉堡:与恋人点完汉堡后只能待在原地等待汉堡出来

### async和await

## 虚拟环境

### 创建一个工程

打开powershell：

```.
💬 进入主目录
cd
💬 创建一个用于存放所有代码工程的目录
mkdir code
💬 进入 code 目录
cd code
💬 创建一个用于存放这个工程的目录
mkdir awesome-project
💬 进入这个工程的目录
cd awesome-project
```

### 创造和激活虚拟环境

powershell：

python -m venv .venv

python: 使用名为 python 的程序
-m: 以脚本的方式调用一个模块，我们将告诉它接下来使用哪个模块
venv: 使用名为 venv 的模块，这个模块通常随 Python 一起安装
.venv: 在新目录 .venv 中创建虚拟环境

激活：

.venv\Scripts\Activate.ps1

每次开始一个新的终端会话来工作在这个工程时，都要写这个代码
每次你在这个环境中安装一个 新的包 时，都需要 重新激活 这个环境。
这么做确保了当你使用一个由这个包安装的 终端（CLI）程序 时，你使用的是你的虚拟环境中的程序，而不是全局安装、可能版本不同的程序。

### 检查虚拟环境是否激活

Get-Command python

### 升级pip

通常在激活虚拟环境后执行一次：

python -m pip install --upgrade pip

### 添加.gitignore

```.
echo "*" > .venv/.gitignore
```

echo "*": 将在终端中 "打印" 文本 `*`（接下来的部分会对这个操作进行一些修改）
>: 使左边的命令打印到终端的任何内容实际上都不会被打印，而是会被写入到右边的文件中
.gitignore: 被写入文本的文件的名称
而 * 对于 Git 来说意味着 "所有内容"。所以，它会忽略 .venv 目录中的所有内容。

该命令会创建一个名为 .gitignore 的文件，内容如下:
`*`

### 退出虚拟环境

deactivate

## 第一步

```c
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message":"Hello World"}
```

在main.py文件中编写，然后在终端运行代码：

`fastapi dev main.py`

在输出中找到诸如INFO:  Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)

### 什么是API什么是接口？

接口是指不同系统之间进行交互的一种方式，它定义了系统之间通信的规则和协议，这里的系统可以是不同的软件、硬件或服务。接口通常包括一组函数、方法、协议或消息格式，用于在不同系统之间传递数据和指令。

人话：可以把接口都类比USB接口，手机有一个USB接口，电脑有一个USB接口，它们之间通过USB接口进行连接和通信，或者与电源连接进行充电。

而在软件设计中，接口通常是指软件组件之间进行交互的一种方式，它定义了组件之间通信的规则和协议。接口可以是函数、方法、协议或消息格式，用于在不同组件之间传递数据和指令。

人话:不管什么接口，他都像生活中的USB接口，负责连接两个设备，让他们获得交互能力，如python的抽象类接口，定义了一个类的行为规范，其他类可以实现这个接口，即实现这个类最基础的功能的同时，也可以添加自己的功能。

api接口是接口的一种，通常通过http协议进行通信，客户端发送请求到服务器，服务器处理请求并返回响应。

人话：仍把api接口定义为usb接口，只是这个接口不需要物理上的数据线连接，更常用网络连接，带有这个usb的电脑就是我们所写的功能，而连接这个usb的设备就是想要和我们的电脑建立连接的用户，用户只需要知道电脑的功能，而不需要知道电脑是如何实现这些功能的，用户（客户端）通过网络，插入电脑的usb（利用接口），并给出数据，最终获得响应。

### OpenAPI

OpenAPI是一种用于描述RESTful API的规范，它定义了API的结构、操作、参数、响应等。OpenAPI规范通常使用JSON或YAML格式编写，并且可以被用于生成API文档、客户端代码、服务器代码等。

人话：当一个用户想通过这个USB(接口)连接电脑时。他虽然知道电脑的功能，但是他传入数据时输入的是英文，而电脑要的是中文，当用户输入了中文，但是电脑要的其实是中文楷体，而OpenAPI规范定义了这个接口的输入输出参数（比如规定为JSON格式），甚至会告诉用户这个api的功能，以及usb的位置（这里可以理解为连接电脑有耳机孔，有typec孔，但是用户就要找usb口）等等

fastapi可以自动生成OpenAPI规范，客户端可以通过这个规范来了解和使用这个api接口。

### HTTP方法

POST：post中文为邮寄，发送，即这个方法是客户端向服务器发送数据的方法，服务器会根据这个数据进行处理，如注册用户，提交表单等。
GET: get指获取，得到，是客户端想要从服务器获取数据的方法，如获取用户信息，获取商品列表等。
PUT: put中文为放置，更新，即客户端向服务器发送数据，服务器根据这个数据进行更新，如更新用户信息，更新商品信息等。
DELETE: delete中文为删除，即客户端向服务器发送数据，服务器根据这个数据进行删除，如删除用户，删除商品等。

### 路径操作函数

fastapi实现路径操作函数需要有路径操作装饰器，装饰器的作用是将函数转换为路径操作函数，如@app.get("/")，@app.post("/")等。

比如客户去了一家银行,大家都知道银行是做什么的（usb连接口连接电脑），但是进去后，要找到一个窗口，向柜台小姐姐实现更为具体的功能，比如取钱什么的（usb连接电脑后，是鼠标操作还是键盘操作），而这个窗口就是@app.get("/")，@app.post("/")等，“”中的内容就是路径，即柜台的位置，可以我们自己设置

### 路径参数

路径参数是指在路径中定义的参数，如@app.get("/items/{item_id}")，其中item_id就是路径参数，客户端在请求时需要提供这个参数，如GET /items/42，其中42就是item_id参数的值。

#### Enmu类

enmu列举枚举的意思，定义路径参数类型时可以是用Enmu类，如：

```python
from enum import Enum

class ModelName(str, Enum):
    alexnet = "alexnet"
    resnet = "resnet"
    lenet = "lenet"
```

这样在检查路径参数时，fastapi会自动检查路径参数是否是ModelName类中定义的枚举值，如GET /items/alexnet，其中alexnet就是ModelName类中定义的枚举值。

### 查询参数和字符串校验--Query

Query可以在定义查询参数时使用，用来检验查询参数或者补充说明
如：

```py
@app.get("/items/")
async def read_items(
    q: Union[str, None] = Query(
        default=None,
        alias="item-query",
        title="Query string",
        description="Query string for the items to search in the database that have a good match",
        min_length=3,
        max_length=50,
        pattern="^fixedquery$",
        deprecated=True,
    ),
):
```

### 路径参数和数值校验--Path

Path作用于路径参数，与Query用法并无不同而且两者都可以进行数值校验：
gt：大于（greater than）
ge：大于等于（greater than or equal）
lt：小于（less than）
le：小于等于（less than or equal）

### 依赖注入

依赖，顾名思义就是依赖于某个函数或者类等可调用对象，依赖他们的代码功能，一个类或者一个函数只需要一个Depend就可以实现其全部功能，不需要一个个再实例对象和调用

### 中间件

中间，即在请求和响应之间发挥作用，收到客户端的请求后可以对请求进行处理，然后将请求再传递给其他部分，接着再获得这些部分的响应，处理这些响应后，再返回这个响应